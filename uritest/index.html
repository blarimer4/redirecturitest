<!DOCTYPE html>
<html>

<head>
  <title>Authenticating...</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      background: #f5f5f5;
    }

    .message {
      text-align: center;
      padding: 40px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
  </style>
</head>

<body>
  <div class="message">
    <p id="message">Completing authentication...</p>
  </div>
  <script>
    const params = new URLSearchParams(window.location.search);
    const code = params.get('code');
    const state = params.get('state');
    const error = params.get('error');

    if (!window.opener) {
      document.getElementById('message').textContent =
        'This page should only be accessed during Teams authentication.';
    } else if (!code && !error) {
      document.getElementById('message').textContent =
        'Invalid request. Please try connecting again.';
    } else {
      window.opener.postMessage({
        type: 'KUBARU_TEAMS_OAUTH_CALLBACK',
        code: code,
        state: state,
        error: error,
        errorDescription: params.get('error_description')
      }, '*');

      window.close();
    }                                                                                                                            
  </script>
</body>

</html>
